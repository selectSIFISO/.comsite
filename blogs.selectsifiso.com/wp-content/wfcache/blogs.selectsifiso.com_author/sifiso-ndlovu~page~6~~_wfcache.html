<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Sifiso Ndlovu | select SIFISO | Page 6</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="" />
<!--[if lt IE 9]>
<script src="http://blogs.selectsifiso.com/wp-content/themes/iconic-one/js/html5.js" type="text/javascript"></script>
<![endif]-->
<p style="font-size:10px;">Plugin by <a target ="_blank" href="http://nickpowers.info/wordpress-plugins/social-author-bio/">Social Author Bio</a></p>
<!-- BEGIN Metadata added by the Add-Meta-Tags WordPress plugin -->
<meta name="robots" content="index,follow,ssis,c#,business intelligence,package" />
<meta name="description" content="Content published by Sifiso Ndlovu. | Page 6" />
<meta name="keywords" content="creating ssis packages, data flow task, execute sql task, sequence container, delimited text files, reading ssis packages, excel workbooks, foreach loop container, for loop container" />
<!-- END Metadata added by the Add-Meta-Tags WordPress plugin -->

    <!-- PVC Template -->
    <script type="text/template" id="pvc-stats-view-template">
	<% if ( total_view > 0 ) { %>
		<%= total_view %> <%= total_view > 1 ? "total views" : "total view" %>,
		<% if ( today_view > 0 ) { %>
			<%= today_view %> <%= today_view > 1 ? "views today" : "view today" %>
		<% } else { %>
		no views today		<% } %>
	<% } else { %>
	No views yet	<% } %>
	</script>
    <link rel="alternate" type="application/rss+xml" title="select SIFISO &raquo; Feed" href="http://blogs.selectsifiso.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="select SIFISO &raquo; Comments Feed" href="http://blogs.selectsifiso.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="select SIFISO &raquo; Posts by Sifiso Ndlovu Feed" href="http://blogs.selectsifiso.com/author/sifiso-ndlovu/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/blogs.selectsifiso.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=06820f499ad3078ba51bb8a3026295a9"}};
			!function(a,b,c){function d(a){var c,d=b.createElement("canvas"),e=d.getContext&&d.getContext("2d"),f=String.fromCharCode;return e&&e.fillText?(e.textBaseline="top",e.font="600 32px Arial","flag"===a?(e.fillText(f(55356,56806,55356,56826),0,0),d.toDataURL().length>3e3):"diversity"===a?(e.fillText(f(55356,57221),0,0),c=e.getImageData(16,16,1,1).data.toString(),e.fillText(f(55356,57221,55356,57343),0,0),c!==e.getImageData(16,16,1,1).data.toString()):("simple"===a?e.fillText(f(55357,56835),0,0):e.fillText(f(55356,57135),0,0),0!==e.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='validate-engine-css-css'  href='http://blogs.selectsifiso.com/wp-content/plugins/wysija-newsletters/css/validationEngine.jquery.css?ver=06820f499ad3078ba51bb8a3026295a9' type='text/css' media='all' />
<link rel='stylesheet' id='oss-social-sharing-front-css'  href='http://blogs.selectsifiso.com/wp-content/plugins/simplified-social-share/oss-social-sharing/assets/css/oss-social-sharing-front.css?ver=06820f499ad3078ba51bb8a3026295a9' type='text/css' media='all' />
<link rel='stylesheet' id='oss-share-widget-style-css'  href='https://sharecdn.social9.com/v2/css/os-share-widget-style.css?ver=06820f499ad3078ba51bb8a3026295a9' type='text/css' media='all' />
<link rel='stylesheet' id='cptch_stylesheet-css'  href='http://blogs.selectsifiso.com/wp-content/plugins/captcha/css/style.css?ver=06820f499ad3078ba51bb8a3026295a9' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='http://blogs.selectsifiso.com/wp-includes/css/dashicons.min.css?ver=06820f499ad3078ba51bb8a3026295a9' type='text/css' media='all' />
<link rel='stylesheet' id='cptch_desktop_style-css'  href='http://blogs.selectsifiso.com/wp-content/plugins/captcha/css/desktop_style.css?ver=06820f499ad3078ba51bb8a3026295a9' type='text/css' media='all' />
<link rel='stylesheet' id='contact-form-7-css'  href='http://blogs.selectsifiso.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=06820f499ad3078ba51bb8a3026295a9' type='text/css' media='all' />
<link rel='stylesheet' id='a3-pvc-style-css'  href='http://blogs.selectsifiso.com/wp-content/plugins/page-views-count/assets/css/style.min.css?ver=06820f499ad3078ba51bb8a3026295a9' type='text/css' media='all' />
<link rel='stylesheet' id='themonic-fonts-css'  href='http://fonts.googleapis.com/css?family=Ubuntu:400,700&#038;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='themonic-style-css'  href='http://blogs.selectsifiso.com/wp-content/themes/iconic-one/style.css?ver=06820f499ad3078ba51bb8a3026295a9' type='text/css' media='all' />
<link rel='stylesheet' id='custom-style-css'  href='http://blogs.selectsifiso.com/wp-content/themes/iconic-one/custom.css?ver=06820f499ad3078ba51bb8a3026295a9' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='themonic-ie-css'  href='http://blogs.selectsifiso.com/wp-content/themes/iconic-one/css/ie.css?ver=06820f499ad3078ba51bb8a3026295a9' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='tablepress-default-css'  href='http://blogs.selectsifiso.com/wp-content/plugins/tablepress/css/default.min.css?ver=06820f499ad3078ba51bb8a3026295a9' type='text/css' media='all' />
<link rel='stylesheet' id='counterize_stylesheet-css'  href='http://blogs.selectsifiso.com/wp-content/plugins/counterize/counterize.css.php?ver=06820f499ad3078ba51bb8a3026295a9' type='text/css' media='all' />
<script type='text/javascript' src='http://blogs.selectsifiso.com/wp-includes/js/jquery/jquery.js?ver=06820f499ad3078ba51bb8a3026295a9'></script>
<script type='text/javascript' src='http://blogs.selectsifiso.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=06820f499ad3078ba51bb8a3026295a9'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var cptch_vars = {"nonce":"bd324e9ed7","ajaxurl":"http:\/\/blogs.selectsifiso.com\/wp-admin\/admin-ajax.php","enlarge":"0"};
/* ]]> */
</script>
<script type='text/javascript' src='http://blogs.selectsifiso.com/wp-content/plugins/captcha/js/front_end_script.js?ver=06820f499ad3078ba51bb8a3026295a9'></script>
<script type='text/javascript' src='http://d1n0x3qji82z53.cloudfront.net/src-min-noconflict/ace.js?ver=06820f499ad3078ba51bb8a3026295a9'></script>
<script type='text/javascript' src='http://blogs.selectsifiso.com/wp-includes/js/underscore.min.js?ver=06820f499ad3078ba51bb8a3026295a9'></script>
<script type='text/javascript' src='http://blogs.selectsifiso.com/wp-includes/js/backbone.min.js?ver=06820f499ad3078ba51bb8a3026295a9'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var vars = {"api_url":"http:\/\/blogs.selectsifiso.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://blogs.selectsifiso.com/wp-content/plugins/page-views-count/assets/js/pvc.backbone.min.js?ver=06820f499ad3078ba51bb8a3026295a9'></script>
<script type='text/javascript' src='http://blogs.selectsifiso.com/wp-content/plugins/counterize/counterize.js.php?ver=06820f499ad3078ba51bb8a3026295a9'></script>
<link rel='https://api.w.org/' href='http://blogs.selectsifiso.com/wp-json/' />

<meta name="description" content="blogs.selectsifiso.com is a weblog that focuses on a variety of technologies such as Microsoft enterprise software offerings (i.e. SQL Server, Windows Server, SharePoint), Open Source technologies (i.e. PHP, JQuery), Mobile Development platforms, as well as, Big Data concepts and implementations. blogs.selectsifiso.com is centered on a collection of contributors’ experiences, observations, and opinions. In addition to blog posts being based off contributors’ experience some posts are as a result of questions posed by blog readers." />
<meta name="keywords" content="selectsifiso, blogs.selectsifiso.com, select SIFISO, select SIFISO Blogs, Sifiso Ndlovu, Sifiso W. Ndlovu, Sifiso W Ndlovu, SSIS, SQL, SQL Server, Integration, Integration Services, SQL Server Integration Services, BI, Business Intelligence, Microsoft,SQL, Package, Packages, Reports, Cubes, SQL Server, SEQUEL,execute,properties,destination,connection" /><meta property="og:locale" content="en_US" />
<link rel="publisher" href="https://plus.google.com/u/1/103041474356156114889" />
<meta name="google-site-verification" content="4GM7tP12ESZ2vVeffPTZGhIJ6Z1KrA44j-EpxBbzk5Q" />
<meta name="msvalidate.01" content="79A618AD90CC58A6052A24AA79F83725" />
<meta name="alexaVerifyID" content="B8h6vtsLdGOfpu2c9ARG5Qfcc78" />
<meta name="yandex-verification" content="69149779cf0fd27c" />
<meta name="p:domain_verify" content="" />
<meta property="og:site_name" content="select SIFISO" />
<meta property="article:publisher" content="https://www.facebook.com/pages/select-SIFISO/652751321424822?ref=bookmarks" />
<meta property="article:author" content="https://www.facebook.com/pages/select-SIFISO/652751321424822?ref=bookmarks" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:site" content="@@selectsifiso"/>
<meta name="twitter:domain" content="@selectsifiso"/>
<meta name="twitter:creator" content="@@selectsifiso"/>    
<meta name="robots" content="index, follow" />
<meta name="revisit-after" content="21 days" />
<meta name="creator" content="Name,Designer,Email Address,or Company" />
<meta name="publisher" content="Designer, Company or Website Name" />
<style type="text/css">
#author-bio-box {
	width:632px;
	background: #;
	border: 1px solid #bbb;
	box-shadow: 5px 5px 2px #888;
	padding: 5px;
}
#author-bio-box img {
	float: left;
	margin-right: 10px;
	margin-bottom: 2px;
}
#author-bio-box .author-name {
	font-weight: bold;
	margin: 0px;
	font-size: 14px;
}
#author-bio-box p {
	font-size: 10px;
	line-height: 14px;
}
#author-bio-box thead th {
	border: 0;
}
#author-bio-box tbody {
	border: 0;
}
.bio-spacer { min-height:44px; padding: 1px; display: block; clear: both; border:1px;}
.bio-socials {
	border-top:solid 1px;
	border-bottom:none;
	border-left:none;
	border-right:none;
	width: 628px;
	height: 32px;
	clear: both;
}
</style></head>
<body class="archive paged author author-sifiso-ndlovu author-316 paged-6 author-paged-6 custom-font-enabled">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
					
		<div class="themonic-logo">
        <a href="http://blogs.selectsifiso.com/" title="select SIFISO" rel="home"><img src="http://blogs.selectsifiso.com/wp-content/uploads/2015/09/selectSIFISOforBlogsNew.png" alt="select SIFISO"></a>
		</div>
		
		<div class="socialmedia">
							<a href="http://default_value" target="_blank"><img src="http://blogs.selectsifiso.com/wp-content/themes/iconic-one/img/twitter.png" alt="Follow us on Twitter"/></a> 
											<a href="http://default_value" target="_blank"><img src="http://blogs.selectsifiso.com/wp-content/themes/iconic-one/img/facebook.png" alt="Follow us on Facebook"/></a>
											<a href="http://default_value" rel="author" target="_blank"><img src="http://blogs.selectsifiso.com/wp-content/themes/iconic-one/img/gplus.png" alt="Follow us on Google Plus"/></a>
									<a class="rss" href="https://www.linkedin.com/company/select-sifiso?trk=biz-companies-cym" target="_blank"><img src="http://blogs.selectsifiso.com/wp-content/uploads/2015/05/linkedin_321.png" alt="Connect with us on LinkedIn"/></a>			
									<a class="rss" href="https://www.youtube.com/channel/UCjloZMqHJaRiXXlnt3y7ZKQ" target="_blank"><img src="http://blogs.selectsifiso.com/wp-content/uploads/2015/05/youtube_logo.png" alt="Tune into our YouTube channel"/></a>			
									<a class="rss" href="http://default_value" target="_blank"><img src="http://blogs.selectsifiso.com/wp-content/themes/iconic-one/img/rss.png" alt="Follow us on rss"/></a>			
						<div class="widget widget_search">
				<form role="search" method="get" id="searchform" class="searchform" action="http://blogs.selectsifiso.com/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form>			</div>
		</div>
		

		
		<nav id="site-navigation" class="themonic-nav" role="navigation">
			<a class="assistive-text" href="#content" title="Skip to content">Skip to content</a>
			<ul id="menu-top" class="nav-menu"><li id="menu-item-11" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-11"><a title="Homepage of select SIFISO Blogs" href="http://www.blogs.selectsifiso.com/">Home</a></li>
<li id="menu-item-790" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-790"><a title="About select SIFISO Blogs" href="http://blogs.selectsifiso.com/about/">About</a></li>
<li id="menu-item-793" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-793"><a title="Blog Posts Archive" href="http://blogs.selectsifiso.com/articles/">Articles</a></li>
<li id="menu-item-741" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-741"><a title="Contributors to select SIFISO Blogs" href="http://blogs.selectsifiso.com/contributors/">Contributors</a></li>
</ul>		</nav><!-- #site-navigation -->
		<div class="clear"></div>
	</header><!-- #masthead -->

	<div id="main" class="wrapper">
	<section id="primary" class="site-content">
		<div id="content" role="main">

		
			
			<header class="archive-header">
				<h1 class="archive-title">Author Archives: <span class="vcard"><a class="url fn n" href="http://blogs.selectsifiso.com/author/sifiso-ndlovu/" title="Sifiso Ndlovu" rel="me">Sifiso Ndlovu</a></span></h1>
			</header><!-- .archive-header -->

			
					<nav id="nav-above" class="navigation" role="navigation">
			<div class="assistive-text">Post navigation</div>
			<div class="nav-previous alignleft"><a href="http://blogs.selectsifiso.com/author/sifiso-ndlovu/page/7/" ><span class="meta-nav">&larr;</span> Older posts</a></div>
			<div class="nav-next alignright"><a href="http://blogs.selectsifiso.com/author/sifiso-ndlovu/page/5/" >Newer posts <span class="meta-nav">&rarr;</span></a></div>
		</nav><!-- #nav-above .navigation -->
	
			
										
	<article id="post-302" class="post-302 post type-post status-publish format-standard hentry category-creating-ssis-packages category-data-flow-task category-execute-sql-task category-sequence-container tag-adventureworks2008r2 tag-c tag-c-programming-language tag-create-sql-view tag-create-ssis-package tag-data-flow-task tag-destination-component tag-dts tag-dynamic-ssis-package tag-execute-sql-task tag-extract-sql-statement-source tag-ole-db tag-oledb-destination tag-oledb-source tag-read-sql-query tag-script-task tag-sequence-container tag-source-component tag-sql-server-2008 tag-sql-server-integration-services tag-sql-view tag-ssis tag-update-view">
				<header class="entry-header">
						<h2 class="entry-title">
				<a href="http://blogs.selectsifiso.com/programmatically-create-data-flow-task-inside-a-sequence-container-using-c/" title="Permalink to Programmatically Create Data Flow Task inside a Sequence Container Using C#" rel="bookmark">Programmatically Create Data Flow Task inside a Sequence Container Using C#</a>
			</h2>
											
			</header><!-- .entry-header -->

				<div class="entry-content">
			<p><span style="text-decoration: underline;"><strong>Abstract</strong></span></p>
<p><em>This article explains how to create an SSIS package with a Data Flow Task inside a Sequence Container using C# programming language.</em></p>
<p><span style="text-decoration: underline;"><strong>Requirements</strong></span></p>
<ul>
<li><em><a style="text-decoration: none; color: green;" href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=17319eb4-299c-43b8-a360-a1c2bd6a421b">Microsoft Visual Studio 2008</a></em><em> </em></li>
<li><em><a style="text-decoration: none; color: green;" href="http://www.microsoft.com/sqlserver/2008/en/us/overview.aspx">SQL Server 2008</a></em></li>
<li><em>AdventureWorks2008R2 database (downloadable database file available <a style="text-decoration: none; color: green;" href="http://msftdbprodsamples.codeplex.com/">here</a>)<br />
</em></li>
</ul>
<p><span style="text-decoration: underline;"><strong>Article</strong></span></p>
<p>If the above requirements are all met, we will begin by launching Microsoft Visual Studio 2008.</p>
<p>Create a new project <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/ms138028.aspx">Integration Services Project</a> which is located under <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/ms173767.aspx">Business Intelligence Projects</a>.</p>
<p>After you have named the new project, proceed to click and drag the <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/ms141752.aspx">script task</a> in Control Flow pane of the new package.</p>
<p>Right click the script task and click on &#8220;Edit&#8221;</p>
<p>Under the Script Task Editor change the &#8220;ScriptLanguage&#8221; to &#8220;Microsoft Visual C# 2008&#8221;.</p>
<p>In Project Explorer import relevant references and ensure that you have declared namespaces as below:</p>
<p><a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.aspx">System</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.aspx">System.Data</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sql.aspx">System.Data.Sql</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sqltypes.aspx">System.Data.SqlTypes</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sqlclient.aspx">System.Data.SqlClient</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.server.aspx">Microsoft.SqlServer.Server</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.tasks.scripttask.aspx">Microsoft.SqlServer.Dts.Tasks</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://technet.microsoft.com/en-us/library/microsoft.sqlserver.dts.tasks.executesqltask.executesqltask.aspx">Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.aspx">Microsoft.SqlServer.Dts.Runtime</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.wrapper.aspx">Microsoft.SqlServer.Dts.Pipeline.Wrapper</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.wrapper.aspx">RuntimeWrapper = Microsoft.SqlServer.Dts.Runtime.Wrapper</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.io.aspx">System.IO</a>;</p>
<p>After declarations, create an instance of application and package:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Application SIFISO_app = new Application();<br />
Package dyna_pkg = new Package();</a></p>
<p>Create a connection to AdventureWorks2008R2 database.<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">ConnectionManager ConMgr = dyna_pkg.Connections.Add(&#8220;OLEDB&#8221;);<br />
ConMgr.ConnectionString = &#8220;Provider=SQLOLEDB.1;&#8221; +<br />
&#8220;Integrated Security=SSPI;Initial Catalog=AdventureWorks2008R2;&#8221; +<br />
&#8220;Data Source=(local);&#8221;;<br />
ConMgr.Name = &#8220;ConMgr_OLEDB&#8221;;<br />
ConMgr.Description = &#8220;OLE DB connection to the AdventureWorks2008R2 database.&#8221;;</a></p>
<p>Insert a Sequence container:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Sequence exec_SEQ = (Sequence)dyna_pkg.Executables.Add(&#8220;STOCK:SEQUENCE&#8221;);<br />
exec_SEQ.FailPackageOnFailure = true;<br />
exec_SEQ.FailParentOnFailure = true;<br />
exec_SEQ.Name = @&#8221;select SIFISO Sequence Container&#8221;;<br />
exec_SEQ.Description = @&#8221;select SIFISO Sequence Container&#8221;;</a></p>
<p>Add the following Execute SQL Tasks:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Executable exec = exec_SEQ.Executables.Add(&#8220;STOCK:SQLTask&#8221;);<br />
TaskHost th = exec as TaskHost;<br />
th.Properties[&#8220;Name&#8221;].SetValue(th, &#8220;Create View&#8221;);<br />
th.Properties[&#8220;Description&#8221;].SetValue(th, &#8220;Drops and Create SQL View which based on Adventureworks database&#8221;);<br />
th.Properties[&#8220;Connection&#8221;].SetValue(th, &#8220;ConMgr_OLEDB&#8221;);<br />
th.Properties[&#8220;SqlStatementSource&#8221;].SetValue(th, &#8220;CREATE OR REPLACE VIEW v_Sales as select * from Employee&#8221;);</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Executable exec2 = exec_SEQ.Executables.Add(&#8220;STOCK:SQLTask&#8221;);<br />
TaskHost th2 = exec2 as TaskHost;<br />
th2.Properties[&#8220;Name&#8221;].SetValue(th2, &#8220;select from view&#8221;);<br />
th2.Properties[&#8220;Description&#8221;].SetValue(th2, &#8220;select from view&#8221;);<br />
th2.Properties[&#8220;Connection&#8221;].SetValue(th2, &#8220;ConMgr_OLEDB&#8221;);<br />
th2.Properties[&#8220;SqlStatementSource&#8221;].SetValue(th2, &#8220;SELECT * FROM v_Sales&#8221;);</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Executable exec3 = dyna_pkg.Executables.Add(&#8220;STOCK:SQLTask&#8221;);<br />
TaskHost th3 = exec3 as TaskHost;<br />
th3.Properties[&#8220;Name&#8221;].SetValue(th3, &#8220;delete View&#8221;);<br />
th3.Properties[&#8220;Description&#8221;].SetValue(th3, &#8220;delete View&#8221;);<br />
th3.Properties[&#8220;Connection&#8221;].SetValue(th3, &#8220;ConMgr_OLEDB&#8221;);<br />
th3.Properties[&#8220;SqlStatementSource&#8221;].SetValue(th3, &#8220;DROP VIEW v_Sales&#8221;);</a></p>
<p>Insert a data flow task:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Executable e = exec_SEQ.Executables.Add(&#8220;STOCK:PipelineTask&#8221;);<br />
TaskHost thMainPipe = e as TaskHost;<br />
MainPipe dataFlowTask = thMainPipe.InnerObject as MainPipe;<br />
thMainPipe.Name = &#8220;selectSIFISO data Flow&#8221;;</a></p>
<p>Add a source OLEDB connection manager to the package:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
ConnectionManager cm = dyna_pkg.Connections.Add(&#8220;OLEDB&#8221;);<br />
cm.Name = &#8220;OLEDB ConnectionManager&#8221;;<br />
cm.ConnectionString = string.Format(<br />
&#8220;Provider=SQLOLEDB.1;Data Source={0};Initial Catalog={1};Integrated Security=SSPI;&#8221;, &#8220;your_source_server&#8221;, &#8220;your_db&#8221;);<br />
</a></p>
<p>Add a destination OLEDB connection manager to the package:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
// Add an OLEDB connection manager to the package.<br />
ConnectionManager cm_DES = dyna_pkg.Connections.Add(&#8220;OLEDB&#8221;);<br />
cm_DES.Name = &#8220;DES OLEDB&#8221;;<br />
cm_DES.ConnectionString = string.Format(<br />
&#8220;Provider=SQLOLEDB.1;Data Source={0};Initial Catalog={1};Integrated Security=SSPI;&#8221;, &#8220;your_destination_server&#8221;, &#8220;your_db&#8221;);</a></p>
<p>Add an OLE DB source to the data flow:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
IDTSComponentMetaData100 component =<br />
dataFlowTask.ComponentMetaDataCollection.New();<br />
component.Name = &#8220;OLEDBSource&#8221;;<br />
component.ComponentClassID = &#8220;DTSAdapter.OleDbSource.2&#8221;;</a></p>
<p>Get the design time instance of the component and initialize the component:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
CManagedComponentWrapper instance = component.Instantiate();<br />
instance.ProvideComponentProperties();</a></p>
<p>Specify the connection manager:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
if (component.RuntimeConnectionCollection.Count &gt; 0)<br />
{<br />
component.RuntimeConnectionCollection[0].ConnectionManager =<br />
DtsConvert.GetExtendedInterface(dyna_pkg.Connections[0]);<br />
component.RuntimeConnectionCollection[0].ConnectionManagerID =<br />
dyna_pkg.Connections[0].ID;<br />
}</a></p>
<p>Set the custom properties:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
instance.SetComponentProperty(&#8220;AccessMode&#8221;, 2);<br />
instance.SetComponentProperty(&#8220;SqlCommand&#8221;,<br />
&#8220;SELECT * FROM your_source_table&#8221;);</a></p>
<p>Reinitialize the source metadata:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
instance.AcquireConnections(null);<br />
instance.ReinitializeMetaData();<br />
instance.ReleaseConnections();</a></p>
<p>Add the destination component:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
IDTSComponentMetaData100 destination =<br />
dataFlowTask.ComponentMetaDataCollection.New();<br />
destination.ComponentClassID = &#8220;DTSAdapter.OleDbDestination&#8221;;<br />
destination.Name = &#8220;OLEDBDestination&#8221;;</a></p>
<p>Get destination design-time instance and initialise component:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
CManagedComponentWrapper destDesignTime = destination.Instantiate();<br />
destDesignTime.ProvideComponentProperties();</a></p>
<p>Set destination connection:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
destination.RuntimeConnectionCollection[0].ConnectionManagerID = cm_DES.ID;<br />
destination.RuntimeConnectionCollection[0].ConnectionManager = DtsConvert.ToConnectionManager90(cm_DES);</a></p>
<p>Set destination table name:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
destDesignTime.SetComponentProperty(&#8220;OpenRowset&#8221;, &#8220;your_destination_table&#8221;);<br />
destDesignTime.SetComponentProperty(&#8220;AccessMode&#8221;, 3);<br />
destDesignTime.SetComponentProperty(&#8220;FastLoadOptions&#8221;, &#8220;TABLOCK,CHECK_CONSTRAINTS&#8221;);</a></p>
<p>Connect the source to destination component:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
dataFlowTask.PathCollection.New().AttachPathAndPropagateNotifications(component.OutputCollection[0],<br />
destination.InputCollection[0]);</a></p>
<p>Get input and virtual input for destination to select and map columns:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
IDTSInput100 destinationInputerr = destination.InputCollection[0];<br />
IDTSVirtualInput100 destinationVirtualInputerr = destinationInputerr.GetVirtualInput();<br />
IDTSVirtualInputColumnCollection100 destinationVirtualInputColumnserr =<br />
destinationVirtualInputerr.VirtualInputColumnCollection;<br />
</a></p>
<p>Reinitialize the destination metadata:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
destDesignTime.AcquireConnections(null);<br />
destDesignTime.ReinitializeMetaData();<br />
destDesignTime.ReleaseConnections();</a></p>
<p>Get the destination&#8217;s default input and virtual input:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
IDTSInput100 input = destination.InputCollection[0];<br />
IDTSVirtualInput100 vInput = input.GetVirtualInput();</a></p>
<p>Iterate through the virtual input column collection:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
foreach (IDTSVirtualInputColumn100 vColumn in vInput.VirtualInputColumnCollection)<br />
{<br />
// Select column, and retain new input column<br />
IDTSInputColumn100 inputColumn = destDesignTime.SetUsageType(input.ID,<br />
vInput, vColumn.LineageID, DTSUsageType.UT_READONLY);<br />
// Find external column by name<br />
IDTSExternalMetadataColumn100 externalColumn =<br />
input.ExternalMetadataColumnCollection[inputColumn.Name];<br />
// Map input column to external column<br />
destDesignTime.MapInputColumn(input.ID, inputColumn.ID, externalColumn.ID);</a></p>
<p>Join the Execute SQL Tasks:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">PrecedenceConstraint pcFileTasks3 =<br />
exec_SEQ.PrecedenceConstraints.Add((Executable)exec, (Executable)e);<br />
pcFileTasks3.Value = DTSExecResult.Success;</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">PrecedenceConstraint pcFileTasks =<br />
exec_SEQ.PrecedenceConstraints.Add((Executable)e, (Executable)exec2);<br />
pcFileTasks.Value = DTSExecResult.Success;</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">PrecedenceConstraint pcFileTasks2 =<br />
dyna_pkg.PrecedenceConstraints.Add((Executable)exec_SEQ, (Executable)exec3);<br />
pcFileTasks2.Value = DTSExecResult.Success;</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"> </a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"></a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">SIFISO_app.SaveToXml(&#8220;C:\\TEMP\\pkg_create_DTS_Seq_Sql_Tasks.dtsx&#8221;, dyna_pkg, null);<br />
</a></p>
<p>We then save the package into a file system.</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Dts.TaskResult = (int)ScriptResults.Success;</a><br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">SIFISO_app.SaveToXml(&#8220;C:\\TEMP\\pkg_create_DTS.dtsx&#8221;, dyna_pkg, null);</a></p>
<p><span style="text-decoration: underline;"><strong>Conclusion</strong></span></p>
<p>It&#8217;s that simple!</p>
<p>You can now execute your script task and the package will be created in location you specified.
<div class="pvc_clear"></div>
<p id="pvc_stats_302" class="pvc_stats " element-id="302"><img src="http://blogs.selectsifiso.com/wp-content/plugins/page-views-count/ajax-loader.gif" border=0 /></p>
<div class="pvc_clear"></div>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
		<span>Category: <a href="http://blogs.selectsifiso.com/category/creating-ssis-packages/" rel="category tag">Creating SSIS Packages</a> <a href="http://blogs.selectsifiso.com/category/data-flow-task/" rel="category tag">Data Flow Task</a> <a href="http://blogs.selectsifiso.com/category/execute-sql-task/" rel="category tag">Execute SQL Task</a> <a href="http://blogs.selectsifiso.com/category/sequence-container/" rel="category tag">Sequence Container</a></span> <span>Tags: <a href="http://blogs.selectsifiso.com/tag/adventureworks2008r2/" rel="tag">AdventureWorks2008R2</a>, <a href="http://blogs.selectsifiso.com/tag/c/" rel="tag">C#</a>, <a href="http://blogs.selectsifiso.com/tag/c-programming-language/" rel="tag">C# programming language</a>, <a href="http://blogs.selectsifiso.com/tag/create-sql-view/" rel="tag">create SQL view</a>, <a href="http://blogs.selectsifiso.com/tag/create-ssis-package/" rel="tag">Create SSIS Package</a>, <a href="http://blogs.selectsifiso.com/tag/data-flow-task/" rel="tag">Data Flow Task</a>, <a href="http://blogs.selectsifiso.com/tag/destination-component/" rel="tag">Destination Component</a>, <a href="http://blogs.selectsifiso.com/tag/dts/" rel="tag">DTS</a>, <a href="http://blogs.selectsifiso.com/tag/dynamic-ssis-package/" rel="tag">Dynamic SSIS Package</a>, <a href="http://blogs.selectsifiso.com/tag/execute-sql-task/" rel="tag">Execute SQL Task</a>, <a href="http://blogs.selectsifiso.com/tag/extract-sql-statement-source/" rel="tag">Extract SQL Statement source</a>, <a href="http://blogs.selectsifiso.com/tag/ole-db/" rel="tag">OLE DB</a>, <a href="http://blogs.selectsifiso.com/tag/oledb-destination/" rel="tag">OLEDB Destination</a>, <a href="http://blogs.selectsifiso.com/tag/oledb-source/" rel="tag">OLEDB Source</a>, <a href="http://blogs.selectsifiso.com/tag/read-sql-query/" rel="tag">Read SQL Query</a>, <a href="http://blogs.selectsifiso.com/tag/script-task/" rel="tag">script task</a>, <a href="http://blogs.selectsifiso.com/tag/sequence-container/" rel="tag">Sequence Container</a>, <a href="http://blogs.selectsifiso.com/tag/source-component/" rel="tag">Source Component</a>, <a href="http://blogs.selectsifiso.com/tag/sql-server-2008/" rel="tag">SQL Server 2008</a>, <a href="http://blogs.selectsifiso.com/tag/sql-server-integration-services/" rel="tag">SQL Server Integration Services</a>, <a href="http://blogs.selectsifiso.com/tag/sql-view/" rel="tag">SQL view</a>, <a href="http://blogs.selectsifiso.com/tag/ssis/" rel="tag">SSIS</a>, <a href="http://blogs.selectsifiso.com/tag/update-view/" rel="tag">update view</a></span> 
           						</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-288" class="post-288 post type-post status-publish format-standard hentry category-creating-ssis-packages category-data-flow-task tag-adventureworks2008r2 tag-c tag-c-programming-language tag-create-ssis-package tag-data-flow-task tag-destination-component tag-dts tag-dynamic-ssis-package tag-ole-db tag-oledb-destination tag-oledb-source tag-script-task tag-source-component tag-sql-server-2008 tag-sql-server-integration-services tag-ssis">
				<header class="entry-header">
						<h2 class="entry-title">
				<a href="http://blogs.selectsifiso.com/programmatically-create-data-flow-task-in-ssis-package-using-c/" title="Permalink to Programmatically Create Data Flow Task in SSIS Package Using C#" rel="bookmark">Programmatically Create Data Flow Task in SSIS Package Using C#</a>
			</h2>
											
			</header><!-- .entry-header -->

				<div class="entry-content">
			<p><span style="text-decoration: underline;"><strong>Abstract</strong></span></p>
<p><em>This article explains how to create an SSIS package with a Data Flow Task using C# programming language.</em></p>
<p><span style="text-decoration: underline;"><strong>Requirements</strong></span></p>
<ul>
<li><em><a style="text-decoration: none; color: green;" href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=17319eb4-299c-43b8-a360-a1c2bd6a421b">Microsoft Visual Studio 2008</a></em><em> </em></li>
<li><em><a style="text-decoration: none; color: green;" href="http://www.microsoft.com/sqlserver/2008/en/us/overview.aspx">SQL Server 2008</a></em></li>
<li><em>AdventureWorks2008R2 database (downloadable database file available <a style="text-decoration: none; color: green;" href="http://msftdbprodsamples.codeplex.com/">here</a>)<br />
</em></li>
</ul>
<p><span style="text-decoration: underline;"><strong>Article</strong></span></p>
<p>If the above requirements are all met, we will begin by launching Microsoft Visual Studio 2008.</p>
<p>Create a new project <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/ms138028.aspx">Integration Services Project</a> which is located under <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/ms173767.aspx">Business Intelligence Projects</a>.</p>
<p>After you have named the new project, proceed to click and drag the <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/ms141752.aspx">script task</a> in Control Flow pane of the new package.</p>
<p>Right click the script task and click on &#8220;Edit&#8221;</p>
<p>Under the Script Task Editor change the &#8220;ScriptLanguage&#8221; to &#8220;Microsoft Visual C# 2008&#8221;.</p>
<p>In Project Explorer import relevant references and ensure that you have declared namespaces as below:</p>
<p><a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.server.aspx">Microsoft.SqlServer.Server</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.tasks.scripttask.aspx">Microsoft.SqlServer.Dts.Tasks</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://technet.microsoft.com/en-us/library/microsoft.sqlserver.dts.tasks.executesqltask.executesqltask.aspx">Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.aspx">Microsoft.SqlServer.Dts.Runtime</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.wrapper.aspx">Microsoft.SqlServer.Dts.Pipeline.Wrapper</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.wrapper.aspx">RuntimeWrapper = Microsoft.SqlServer.Dts.Runtime.Wrapper</a>;</p>
<p>After declarations, create an instance of application and package:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Application SIFISO_app = new Application();<br />
Package p = new Package();</a></p>
<p>Insert a data flow task:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Executable e = p.Executables.Add(&#8220;STOCK:PipelineTask&#8221;);<br />
TaskHost thMainPipe = e as TaskHost;<br />
MainPipe dataFlowTask = thMainPipe.InnerObject as MainPipe;<br />
thMainPipe.Name = &#8220;selectSIFISO data Flow&#8221;;</a></p>
<p>Add a source OLEDB connection manager to the package:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">ConnectionManager cm = p.Connections.Add(&#8220;OLEDB&#8221;);<br />
cm.Name = &#8220;OLEDB ConnectionManager&#8221;;<br />
cm.ConnectionString = string.Format(<br />
&#8220;Provider=SQLOLEDB.1;Data Source={0};Initial Catalog={1};Integrated Security=SSPI;&#8221;, &#8220;your_Source_SQL_Server&#8221;, &#8220;your_Source_SQL_Database&#8221;);</a></p>
<p>Add a destination OLEDB connection manager to the package:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">ConnectionManager cm = p.Connections.Add(&#8220;OLEDB&#8221;);<br />
cm.Name = &#8220;OLEDB ConnectionManager&#8221;;<br />
cm.ConnectionString = string.Format(<br />
&#8220;Provider=SQLOLEDB.1;Data Source={0};Initial Catalog={1};Integrated Security=SSPI;&#8221;, &#8220;your_Destination_SQL_Server&#8221;, &#8220;your_Destination_SQL_Database&#8221;);</a></p>
<p>Add an OLE DB source to the data flow:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">IDTSComponentMetaData100 component =<br />
dataFlowTask.ComponentMetaDataCollection.New();<br />
component.Name = &#8220;OLEDBSource&#8221;;<br />
component.ComponentClassID = &#8220;DTSAdapter.OleDbSource.2&#8221;;</a></p>
<p>Get the design time instance of the component and initialize the component:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">CManagedComponentWrapper instance = component.Instantiate();</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"> </a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">instance.ProvideComponentProperties();</a></p>
<p>Specify the connection manager:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">if (component.RuntimeConnectionCollection.Count &gt; 0)<br />
{<br />
component.RuntimeConnectionCollection[0].ConnectionManager =<br />
DtsConvert.GetExtendedInterface(p.Connections[0]);<br />
component.RuntimeConnectionCollection[0].ConnectionManagerID =<br />
p.Connections[0].ID;      }</a></p>
<p>Set the custom properties:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">instance.SetComponentProperty(&#8220;AccessMode&#8221;, 2);<br />
instance.SetComponentProperty(&#8220;SqlCommand&#8221;,<br />
&#8220;SELECT * FROM your_source_table&#8221;);</a></p>
<p>Reinitialize the source metadata:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">instance.AcquireConnections(null);<br />
instance.ReinitializeMetaData();<br />
instance.ReleaseConnections();</a></p>
<p>Add the destination component:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">IDTSComponentMetaData100 destination =<br />
dataFlowTask.ComponentMetaDataCollection.New();<br />
destination.ComponentClassID = &#8220;DTSAdapter.OleDbDestination&#8221;;<br />
destination.Name = &#8220;OLEDBDestination&#8221;;</a></p>
<p>Get destination design-time instance and initialise component:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">CManagedComponentWrapper destDesignTime = destination.Instantiate();<br />
destDesignTime.ProvideComponentProperties();</a></p>
<p>Set destination connection:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">destination.RuntimeConnectionCollection[0].ConnectionManagerID = cm_DES.ID;<br />
destination.RuntimeConnectionCollection[0].ConnectionManager = DtsConvert.ToConnectionManager90(cm_DES);</a></p>
<p>Set destination table name:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">destDesignTime.SetComponentProperty(&#8220;OpenRowset&#8221;, &#8220;your_destination_table&#8221;);<br />
destDesignTime.SetComponentProperty(&#8220;AccessMode&#8221;, 3);<br />
destDesignTime.SetComponentProperty(&#8220;FastLoadOptions&#8221;, &#8220;TABLOCK,CHECK_CONSTRAINTS&#8221;);</a></p>
<p>Connect the source to destination component:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">dataFlowTask.PathCollection.New().AttachPathAndPropagateNotifications(component.OutputCollection[0],<br />
destination.InputCollection[0]);</a></p>
<p>Get input and virtual input for destination to select and map columns:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">IDTSInput100 destinationInputerr = destination.InputCollection[0];<br />
IDTSVirtualInput100 destinationVirtualInputerr = destinationInputerr.GetVirtualInput();<br />
IDTSVirtualInputColumnCollection100 destinationVirtualInputColumnserr =<br />
destinationVirtualInputerr.VirtualInputColumnCollection;</a></p>
<p>Reinitialize the destination metadata:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">destDesignTime.AcquireConnections(null);<br />
destDesignTime.ReinitializeMetaData();<br />
destDesignTime.ReleaseConnections();</a></p>
<p>Get the destination&#8217;s default input and virtual input:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">IDTSInput100 input = destination.InputCollection[0];<br />
IDTSVirtualInput100 vInput = input.GetVirtualInput();</a></p>
<p>Iterate through the virtual input column collection:</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">foreach (IDTSVirtualInputColumn100 vColumn in vInput.VirtualInputColumnCollection)<br />
{<br />
// Select column, and retain new input column<br />
IDTSInputColumn100 inputColumn = destDesignTime.SetUsageType(input.ID,<br />
vInput, vColumn.LineageID, DTSUsageType.UT_READONLY);<br />
// Find external column by name<br />
IDTSExternalMetadataColumn100 externalColumn =<br />
input.ExternalMetadataColumnCollection[inputColumn.Name];<br />
// Map input column to external column<br />
destDesignTime.MapInputColumn(input.ID, inputColumn.ID, externalColumn.ID);</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">}</a><br />
We then save the package into a file system.</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Dts.TaskResult = (int)ScriptResults.Success;</a><br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">SIFISO_app.SaveToXml(&#8220;C:\\TEMP\\pkg_create_DTS.dtsx&#8221;, dyna_pkg, null);</a></p>
<p><span style="text-decoration: underline;"><strong>Conclusion</strong></span></p>
<p>It&#8217;s that simple!</p>
<p>You can now execute your script task and the package will be created in location you specified.
<div class="pvc_clear"></div>
<p id="pvc_stats_288" class="pvc_stats " element-id="288"><img src="http://blogs.selectsifiso.com/wp-content/plugins/page-views-count/ajax-loader.gif" border=0 /></p>
<div class="pvc_clear"></div>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
		<span>Category: <a href="http://blogs.selectsifiso.com/category/creating-ssis-packages/" rel="category tag">Creating SSIS Packages</a> <a href="http://blogs.selectsifiso.com/category/data-flow-task/" rel="category tag">Data Flow Task</a></span> <span>Tags: <a href="http://blogs.selectsifiso.com/tag/adventureworks2008r2/" rel="tag">AdventureWorks2008R2</a>, <a href="http://blogs.selectsifiso.com/tag/c/" rel="tag">C#</a>, <a href="http://blogs.selectsifiso.com/tag/c-programming-language/" rel="tag">C# programming language</a>, <a href="http://blogs.selectsifiso.com/tag/create-ssis-package/" rel="tag">Create SSIS Package</a>, <a href="http://blogs.selectsifiso.com/tag/data-flow-task/" rel="tag">Data Flow Task</a>, <a href="http://blogs.selectsifiso.com/tag/destination-component/" rel="tag">Destination Component</a>, <a href="http://blogs.selectsifiso.com/tag/dts/" rel="tag">DTS</a>, <a href="http://blogs.selectsifiso.com/tag/dynamic-ssis-package/" rel="tag">Dynamic SSIS Package</a>, <a href="http://blogs.selectsifiso.com/tag/ole-db/" rel="tag">OLE DB</a>, <a href="http://blogs.selectsifiso.com/tag/oledb-destination/" rel="tag">OLEDB Destination</a>, <a href="http://blogs.selectsifiso.com/tag/oledb-source/" rel="tag">OLEDB Source</a>, <a href="http://blogs.selectsifiso.com/tag/script-task/" rel="tag">script task</a>, <a href="http://blogs.selectsifiso.com/tag/source-component/" rel="tag">Source Component</a>, <a href="http://blogs.selectsifiso.com/tag/sql-server-2008/" rel="tag">SQL Server 2008</a>, <a href="http://blogs.selectsifiso.com/tag/sql-server-integration-services/" rel="tag">SQL Server Integration Services</a>, <a href="http://blogs.selectsifiso.com/tag/ssis/" rel="tag">SSIS</a></span> 
           						</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-284" class="post-284 post type-post status-publish format-standard hentry category-delimitted-text-files category-execute-sql-task category-package-content-extraction tag-c tag-c-programming-language tag-create-sql-view tag-create-ssis-package tag-delimited tag-dynamic-ssis-package tag-execute-sql-task tag-extract-sql-statement-source tag-file tag-flat-file tag-read-sql-query tag-script-task tag-sql-server-2008 tag-sql-server-integration-services tag-sql-view tag-ssis tag-text tag-text-file tag-update-view">
				<header class="entry-header">
						<h2 class="entry-title">
				<a href="http://blogs.selectsifiso.com/extract-sql-statements-in-execute-sql-tasks-and-save-them-into-a-text-delimited-file-using-c/" title="Permalink to Extract SQL Statements in Execute SQL Tasks and save them into a text delimited file using C#" rel="bookmark">Extract SQL Statements in Execute SQL Tasks and save them into a text delimited file using C#</a>
			</h2>
											
			</header><!-- .entry-header -->

				<div class="entry-content">
			<p><span style="text-decoration: underline;"><strong>Abstract</strong></span></p>
<p><em>This article explains how to extract SQL Statements found in Execute SQL Tasks of an SSIS package and save them into a delimited text file using C# programming language.<br />
</em></p>
<p><span style="text-decoration: underline;"><strong>Requirements</strong></span></p>
<ul>
<li><em><a style="text-decoration: none; color: green;" href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=17319eb4-299c-43b8-a360-a1c2bd6a421b">Microsoft Visual Studio 2008</a></em><em> </em></li>
</ul>
<p><span style="text-decoration: underline;"><strong>Article</strong></span></p>
<p>This article continues from another article which can be found <a style="text-decoration: none; color: green;" href="http://www.blogs.selectsifiso.com/?p=82">here</a>.</p>
<p>Launch Visual Studio 2008 and create an Integration Services Project. After the default (new) package has launched, drag a script task to the control flow pane.</p>
<p>Right click to edit the script task. In your Script Task Editor ensure that you have selected Microsoft Visual C# as your programming language.</p>
<p>At the bottom of your Script Task Editor, click &#8220;Edit Script&#8221;.</p>
<p>Add the following namespaces:<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.aspx">System</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.aspx">System.Data</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sqlclient.aspx">System.Data.Sql</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sqltypes.aspx">System.Data.SqlTypes</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sqlclient.aspx">System.Data.SqlClient</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.server.aspx">Microsoft.SqlServer.Server</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.tasks.scripttask.aspx">Microsoft.SqlServer.Dts.Tasks</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://technet.microsoft.com/en-us/library/microsoft.sqlserver.dts.tasks.executesqltask.executesqltask.aspx">Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.aspx">Microsoft.SqlServer.Dts.Runtime</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.wrapper.aspx">Microsoft.SqlServer.Dts.Pipeline.Wrapper</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.wrapper.aspx">RuntimeWrapper = Microsoft.SqlServer.Dts.Runtime.Wrapper</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.io.aspx">System.IO</a>;</p>
<p>Proceed to load the package (that contains the Execute SQL Tasks you would like to extract and save).<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Application app = new Application();<br />
</a><br />
<a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.application.loadfromsqlserver.aspx">Load package</a><br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Package p = app.LoadPackage(&#8220;C:\\TEMP\\pkg_Execute_Sql_Tasks.dtsx&#8221;, null);</a></p>
<p>Declare variables that will be used to store extracted queries:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
//string declare delimiter<br />
            string del = &#8220;|&#8221;; // You can also change it to tab (^) comma (,) etc</p>
<p>string src_query = &#8220;&#8221;;<br />
string sql_task_name = &#8220;&#8221;;<br />
Int32 i = 1;</a></p>
<p>Create text file as follows:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
FileStream fileStream = new FileStream(@&#8221;c:\\TEMP\\selectSIFISO_file.txt&#8221;, FileMode.OpenOrCreate);<br />
            StreamWriter streamWriter = new StreamWriter(fileStream);</p>
<p>            streamWriter.BaseStream.Seek(0, SeekOrigin.Begin);<br />
            streamWriter.WriteLine(&#8220;src_query&#8221; + del + &#8220;sql_task_name&#8221;);<br />
</a></p>
<p>The rest of the code is as follows:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">foreach (Executable executable in importPackage.Executables)<br />
            {<br />
                DtsContainer container = (DtsContainer)executable;<br />
                if (executable.GetType().Name == &#8220;TaskHost&#8221;)<br />
                {<br />
                    i = i + 1;<br />
                    TaskHost loop = (TaskHost)executable;<br />
                    ExecuteSQLTask sqlTask = (ExecuteSQLTask)loop.InnerObject;<br />
                    src_query = sqlTask.SqlStatementSource;<br />
                    sql_task_name = container.Name;</p>
<p>                    string source = src_query;<br />
                    string[] stringSeparators = new string[] { &#8220;GO&#8221; };<br />
                    string[] result;</p>
<p>                    result = source.Split(stringSeparators, StringSplitOptions.None);</p>
<p>                    foreach (string s in result)<br />
                    {<br />
                        // Insert into new records into the workbook<br />
                        streamWriter.BaseStream.Seek(0, SeekOrigin.Begin);<br />
                        streamWriter.WriteLine(s + del + sql_task_name, result);<br />
                    }<br />
                }<br />
            }<br />
            streamWriter.Flush();<br />
            streamWriter.Close();<br />
</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Dts.TaskResult = (int)ScriptResults.Success;</a></p>
<p>We then save the package in a file system.</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">SIFISO_app.SaveToXml(&#8220;C:\\TEMP\\pkg_Execute_Sql_Tasks.dtsx&#8221;, dyna_pkg, null);</a></p>
<p><span style="text-decoration: underline;"><strong>Conclusion</strong></span></p>
<p>It&#8217;s that simple!</p>
<p>You can now execute your script task and the package will be created in location you specified.
<div class="pvc_clear"></div>
<p id="pvc_stats_284" class="pvc_stats " element-id="284"><img src="http://blogs.selectsifiso.com/wp-content/plugins/page-views-count/ajax-loader.gif" border=0 /></p>
<div class="pvc_clear"></div>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
		<span>Category: <a href="http://blogs.selectsifiso.com/category/delimitted-text-files/" rel="category tag">Delimited Text Files</a> <a href="http://blogs.selectsifiso.com/category/execute-sql-task/" rel="category tag">Execute SQL Task</a> <a href="http://blogs.selectsifiso.com/category/package-content-extraction/" rel="category tag">Reading SSIS Packages</a></span> <span>Tags: <a href="http://blogs.selectsifiso.com/tag/c/" rel="tag">C#</a>, <a href="http://blogs.selectsifiso.com/tag/c-programming-language/" rel="tag">C# programming language</a>, <a href="http://blogs.selectsifiso.com/tag/create-sql-view/" rel="tag">create SQL view</a>, <a href="http://blogs.selectsifiso.com/tag/create-ssis-package/" rel="tag">Create SSIS Package</a>, <a href="http://blogs.selectsifiso.com/tag/delimited/" rel="tag">delimited</a>, <a href="http://blogs.selectsifiso.com/tag/dynamic-ssis-package/" rel="tag">Dynamic SSIS Package</a>, <a href="http://blogs.selectsifiso.com/tag/execute-sql-task/" rel="tag">Execute SQL Task</a>, <a href="http://blogs.selectsifiso.com/tag/extract-sql-statement-source/" rel="tag">Extract SQL Statement source</a>, <a href="http://blogs.selectsifiso.com/tag/file/" rel="tag">file</a>, <a href="http://blogs.selectsifiso.com/tag/flat-file/" rel="tag">flat file</a>, <a href="http://blogs.selectsifiso.com/tag/read-sql-query/" rel="tag">Read SQL Query</a>, <a href="http://blogs.selectsifiso.com/tag/script-task/" rel="tag">script task</a>, <a href="http://blogs.selectsifiso.com/tag/sql-server-2008/" rel="tag">SQL Server 2008</a>, <a href="http://blogs.selectsifiso.com/tag/sql-server-integration-services/" rel="tag">SQL Server Integration Services</a>, <a href="http://blogs.selectsifiso.com/tag/sql-view/" rel="tag">SQL view</a>, <a href="http://blogs.selectsifiso.com/tag/ssis/" rel="tag">SSIS</a>, <a href="http://blogs.selectsifiso.com/tag/text/" rel="tag">text</a>, <a href="http://blogs.selectsifiso.com/tag/text-file/" rel="tag">text file</a>, <a href="http://blogs.selectsifiso.com/tag/update-view/" rel="tag">update view</a></span> 
           						</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-278" class="post-278 post type-post status-publish format-standard hentry category-excel-workbook category-execute-sql-task category-package-content-extraction tag-c tag-c-programming-language tag-create-sql-view tag-dynamic-ssis-package tag-excel tag-excel-document tag-excel-source tag-execute-sql-task tag-extract-sql-statement-source tag-read-sql-query tag-script-task tag-sql-server-integration-services tag-sql-view tag-ssis tag-update-view tag-workbook">
				<header class="entry-header">
						<h2 class="entry-title">
				<a href="http://blogs.selectsifiso.com/extract-sql-statements-in-execute-sql-tasks-and-save-them-into-an-excel-workbook-using-c/" title="Permalink to Extract SQL Statements in Execute SQL Tasks and save them into an Excel Workbook using C#" rel="bookmark">Extract SQL Statements in Execute SQL Tasks and save them into an Excel Workbook using C#</a>
			</h2>
											
			</header><!-- .entry-header -->

				<div class="entry-content">
			<p><span style="text-decoration: underline;"><strong>Abstract</strong></span></p>
<p><em>This article explains how to extract SQL Statements found in Execute SQL Tasks of an SSIS package and save them into an Excel Workbook using C# programming language.<br />
</em></p>
<p><span style="text-decoration: underline;"><strong>Requirements</strong></span></p>
<ul>
<li><em><a style="text-decoration: none; color: green;" href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=17319eb4-299c-43b8-a360-a1c2bd6a421b">Microsoft Visual Studio 2008</a></em><em> </em></li>
</ul>
<p><span style="text-decoration: underline;"><strong>Article</strong></span></p>
<p>This article continues from another article which can be found <a style="text-decoration: none; color: green;" href="http://www.blogs.selectsifiso.com/?p=82">here</a>.</p>
<p>Launch Visual Studio 2008 and create an Integration Services Project. After the default (new) package has launched, drag a script task to the control flow pane.</p>
<p>Right click to edit the script task. In your Script Task Editor ensure that you have selected Microsoft Visual C# as your programming language.</p>
<p>At the bottom of your Script Task Editor, click &#8220;Edit Script&#8221;.</p>
<p>The next step is to insert references.</p>
<p>In the Project Explorer, right click &#8220;References&#8221; and click &#8220;Add Reference&#8221;. Click the &#8220;COM&#8221; tab and Choose Microsoft Excel 14.0 Object Library.</p>
<p>Add the following namespaces:<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.office.core%28v=office.11%29.aspx">Microsoft.Office.Core</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.office.interop.excel%28v=office.11%29.aspx">Microsoft.Office.Interop.Excel</a>;</p>
<p>The rest of the references should be declared as follows:</p>
<p><a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.aspx">System</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.aspx">System.Data</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sqlclient.aspx">System.Data.Sql</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sqltypes.aspx">System.Data.SqlTypes</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sqlclient.aspx">System.Data.SqlClient</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.server.aspx">Microsoft.SqlServer.Server</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.tasks.scripttask.aspx">Microsoft.SqlServer.Dts.Tasks</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://technet.microsoft.com/en-us/library/microsoft.sqlserver.dts.tasks.executesqltask.executesqltask.aspx">Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.aspx">Microsoft.SqlServer.Dts.Runtime</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.wrapper.aspx">Microsoft.SqlServer.Dts.Pipeline.Wrapper</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.wrapper.aspx">RuntimeWrapper = Microsoft.SqlServer.Dts.Runtime.Wrapper</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.io.aspx">System.IO</a>;</p>
<p>Proceed to load the package (that contains the Execute SQL Tasks you would like to extract and save).<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Application app = new Application();<br />
</a><br />
<a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.application.loadfromsqlserver.aspx">Load package</a><br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Package p = app.LoadPackage(&#8220;C:\\TEMP\\pkg_Execute_Sql_Tasks.dtsx&#8221;, null);</a></p>
<p>Declare variables that will be used to store extracted queries:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
string src_query = &#8220;&#8221;;<br />
string sql_task_name = &#8220;&#8221;;<br />
Int32 i = 1;</a></p>
<p>Create an instance of an excel application as follows:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"><br />
Excel.Application sS_excelApp;<br />
Excel.Workbook sS_excelWorkBook;<br />
Excel.Worksheet sS_excelWorkSheet;<br />
object misValue = System.Reflection.Missing.Value;</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">sS_excelApp = new Excel.ApplicationClass();<br />
sS_excelWorkBook = sS_excelApp.Workbooks.Add(misValue);</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">sS_excelWorkSheet = (Excel.Worksheet)sS_excelWorkBook.Worksheets.get_Item(1);</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"> </a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"></a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"></a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"> // Create Headings<br />
sS_excelWorkSheet.Cells[1, 1] = &#8220;src_query&#8221;;<br />
sS_excelWorkSheet.Cells[1, 2] = &#8220;sql_task_name&#8221;;<br />
</a></p>
<p>The rest of the code is as follows:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">foreach (Executable executable in importPackage.Executables)<br />
{<br />
DtsContainer container = (DtsContainer)executable;<br />
if (executable.GetType().Name == &#8220;TaskHost&#8221;)<br />
{<br />
i = i + 1;<br />
TaskHost loop = (TaskHost)executable;<br />
ExecuteSQLTask sqlTask = (ExecuteSQLTask)loop.InnerObject;<br />
src_query = sqlTask.SqlStatementSource;<br />
sql_task_name = container.Name;</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">string source = src_query;<br />
string[] stringSeparators = new string[] { &#8220;GO&#8221; };<br />
string[] result;</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">result = source.Split(stringSeparators, StringSplitOptions.None);</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">foreach (string s in result)<br />
{<br />
// Insert into new records into the workbook<br />
sS_excelWorkSheet.Cells[i, 1] = s;<br />
sS_excelWorkSheet.Cells[i, 2] = sql_task_name;<br />
}<br />
}<br />
}</p>
<p>// Save workbook<br />
sS_excelWorkBook.SaveAs(&#8220;C:\\TEMP\\selectSIFISO_Book.xls&#8221;, Excel.XlFileFormat.xlWorkbookNormal, misValue, misValue, misValue, misValue, Excel.XlSaveAsAccessMode.xlExclusive, misValue, misValue, misValue, misValue, misValue);<br />
// Close workbook<br />
sS_excelWorkBook.Close(true, misValue, misValue);<br />
sS_excelApp.Quit();</p>
<p></a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"></a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"></a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"></a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"></a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"></a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"></a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Dts.TaskResult = (int)ScriptResults.Success;</a></p>
<p>We then save the package in a file system.</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">SIFISO_app.SaveToXml(&#8220;C:\\TEMP\\pkg_Execute_Sql_Tasks.dtsx&#8221;, dyna_pkg, null);</a></p>
<p><span style="text-decoration: underline;"><strong>Conclusion</strong></span></p>
<p>It&#8217;s that simple!</p>
<p>You can now execute your script task and the package will be created in location you specified.
<div class="pvc_clear"></div>
<p id="pvc_stats_278" class="pvc_stats " element-id="278"><img src="http://blogs.selectsifiso.com/wp-content/plugins/page-views-count/ajax-loader.gif" border=0 /></p>
<div class="pvc_clear"></div>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
		<span>Category: <a href="http://blogs.selectsifiso.com/category/excel-workbook/" rel="category tag">Excel Workbooks</a> <a href="http://blogs.selectsifiso.com/category/execute-sql-task/" rel="category tag">Execute SQL Task</a> <a href="http://blogs.selectsifiso.com/category/package-content-extraction/" rel="category tag">Reading SSIS Packages</a></span> <span>Tags: <a href="http://blogs.selectsifiso.com/tag/c/" rel="tag">C#</a>, <a href="http://blogs.selectsifiso.com/tag/c-programming-language/" rel="tag">C# programming language</a>, <a href="http://blogs.selectsifiso.com/tag/create-sql-view/" rel="tag">create SQL view</a>, <a href="http://blogs.selectsifiso.com/tag/dynamic-ssis-package/" rel="tag">Dynamic SSIS Package</a>, <a href="http://blogs.selectsifiso.com/tag/excel/" rel="tag">Excel</a>, <a href="http://blogs.selectsifiso.com/tag/excel-document/" rel="tag">Excel Document</a>, <a href="http://blogs.selectsifiso.com/tag/excel-source/" rel="tag">Excel Source</a>, <a href="http://blogs.selectsifiso.com/tag/execute-sql-task/" rel="tag">Execute SQL Task</a>, <a href="http://blogs.selectsifiso.com/tag/extract-sql-statement-source/" rel="tag">Extract SQL Statement source</a>, <a href="http://blogs.selectsifiso.com/tag/read-sql-query/" rel="tag">Read SQL Query</a>, <a href="http://blogs.selectsifiso.com/tag/script-task/" rel="tag">script task</a>, <a href="http://blogs.selectsifiso.com/tag/sql-server-integration-services/" rel="tag">SQL Server Integration Services</a>, <a href="http://blogs.selectsifiso.com/tag/sql-view/" rel="tag">SQL view</a>, <a href="http://blogs.selectsifiso.com/tag/ssis/" rel="tag">SSIS</a>, <a href="http://blogs.selectsifiso.com/tag/update-view/" rel="tag">update view</a>, <a href="http://blogs.selectsifiso.com/tag/workbook/" rel="tag">Workbook</a></span> 
           						</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-242" class="post-242 post type-post status-publish format-standard hentry category-execute-sql-task category-forach-loop-container category-package-content-extraction tag-adventureworks2008r2 tag-c tag-c-programming-language tag-create-sql-view tag-create-ssis-package tag-dynamic-ssis-package tag-execute-sql-task tag-extract-sql-statement-source tag-foreach-loop tag-foreachloop-container tag-read-sql-query tag-script-task tag-sql-server-2008 tag-sql-server-integration-services tag-sql-view tag-ssis tag-update-view">
				<header class="entry-header">
						<h2 class="entry-title">
				<a href="http://blogs.selectsifiso.com/extract-save-sql-statements-of-execute-sql-tasks-in-a-foreach-loop-container-using-c/" title="Permalink to Extract &#038; Save SQL Statements of Execute SQL Tasks in a ForEach Loop Container using C#" rel="bookmark">Extract &#038; Save SQL Statements of Execute SQL Tasks in a ForEach Loop Container using C#</a>
			</h2>
											
			</header><!-- .entry-header -->

				<div class="entry-content">
			<p><span style="text-decoration: underline;"><strong>Abstract</strong></span></p>
<p><em>This article explains how to extract and save SQL Statements found in Execute SQL Tasks of an SSIS package that contains ForEach Loop container using C# programming language.<br />
</em></p>
<p><span style="text-decoration: underline;"><strong>Requirements</strong></span></p>
<ul>
<li><em><a style="text-decoration: none; color: green;" href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=17319eb4-299c-43b8-a360-a1c2bd6a421b">Microsoft Visual Studio 2008</a></em><em> </em></li>
<li><em><a style="text-decoration: none; color: green;" href="http://www.microsoft.com/sqlserver/2008/en/us/overview.aspx">SQL Server 2008</a></em></li>
</ul>
<p><span style="text-decoration: underline;"><strong>Article</strong></span></p>
<p>This article continues from another article which can be found <a style="text-decoration: none; color: green;" href="http://www.blogs.selectsifiso.com/?p=214">here</a>.</p>
<p>Launch Visual Studio 2008 and create an Integration Services Project. After the default (new) package has launched, drag a script task to the control flow pane.</p>
<p>Right click to edit the script task. In your Script Task Editor ensure that you have selected Microsoft Visual C# as your programming language.</p>
<p>At the bottom of your Script Task Editor, click &#8220;Edit Script&#8221;.</p>
<p>Add the following references:</p>
<p><a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.aspx">System</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.aspx">System.Data</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sqlclient.aspx">System.Data.Sql</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sqltypes.aspx">System.Data.SqlTypes</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sqlclient.aspx">System.Data.SqlClient</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.server.aspx">Microsoft.SqlServer.Server</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.tasks.scripttask.aspx">Microsoft.SqlServer.Dts.Tasks</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://technet.microsoft.com/en-us/library/microsoft.sqlserver.dts.tasks.executesqltask.executesqltask.aspx">Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.aspx">Microsoft.SqlServer.Dts.Runtime</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.wrapper.aspx">Microsoft.SqlServer.Dts.Pipeline.Wrapper</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.wrapper.aspx">RuntimeWrapper = Microsoft.SqlServer.Dts.Runtime.Wrapper</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.io.aspx">System.IO</a>;</p>
<p>Proceed to load the package (that contains the Execute SQL Tasks you would like to extract and save).<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Application app = new Application();<br />
</a><br />
<a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.application.loadfromsqlserver.aspx">Load package</a><br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Package p = app.LoadPackage(&#8220;C:\\TEMP\\pkg_Execute_Sql_Tasks.dtsx&#8221;, null);</a></p>
<p>Establish a connection to SQL database where you will store the extracted SQL statements:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">SqlConnection connectiont = new SqlConnection(<br />
string.Format(&#8220;Data Source={0};Initial Catalog={1};Integrated Security=SSPI;&#8221;, &#8220;(local)&#8221;, &#8220;your_db&#8221;));<br />
SqlCommand commandt;<br />
connectiont.Open();</a></p>
<p>Declare variables that will be used to store extracted queries:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">string src_query2 = &#8220;&#8221;;<br />
string src_query3 = &#8220;&#8221;;<br />
string src_query = &#8220;&#8221;;<br />
string sql_task_name = &#8220;&#8221;;</a></p>
<p>The rest of the code is as follows:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">foreach (Executable executable in importPackage.Executables)<br />
{<br />
//This part is for Execute SQL Tasks found within the ForEach Loop Container<br />
DtsContainer container = (DtsContainer)executable;<br />
if (executable.GetType().Name == &#8220;ForEachLoop&#8221;)<br />
{<br />
ForEachLoop seq = (ForEachLoop)executable;<br />
foreach (Executable ForLp_exec in seq.Executables)<br />
{<br />
DtsContainer ForLp_container = (DtsContainer)ForLp_exec;<br />
if (ForLp_exec.GetType().Name == &#8220;TaskHost&#8221;)<br />
{<br />
TaskHost loop = (TaskHost)ForLp_exec;<br />
ExecuteSQLTask sqlTask = (ExecuteSQLTask)loop.InnerObject;<br />
src_query2 = sqlTask.SqlStatementSource;<br />
src_query3 = src_query2.ToUpper();<br />
src_query = src_query3;<br />
sql_task_name = ForLp_container.Name;</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">//Split extracted queries on keyword Go<br />
string source3 = src_query;<br />
string[] stringSeparators3 = new string[] { &#8220;GO&#8221; };<br />
string[] result3;</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">result3 = source3.Split(stringSeparators3, StringSplitOptions.None);</p>
<p>foreach (string s in result3)<br />
{<br />
//NB: You can replace table name &#8220;SQL_Task&#8221; with your own table<br />
commandt = new SqlCommand(&#8220;INSERT INTO SQL_Task VALUES(@SRC_Q,@SQL_NAME)&#8221;, connectiont);<br />
commandt.Parameters.Add(new SqlParameter(&#8220;@SRC_Q&#8221;, s));<br />
commandt.Parameters.Add(new SqlParameter(&#8220;@SQL_NAME&#8221;, sql_task_name));<br />
commandt.ExecuteNonQuery();<br />
}<br />
}<br />
}<br />
}<br />
//This part is for Execute SQL Tasks found outside of the ForEach Loop Container<br />
if (executable.GetType().Name == &#8220;TaskHost&#8221;)<br />
{<br />
TaskHost loop = (TaskHost)executable;<br />
ExecuteSQLTask sqlTask = (ExecuteSQLTask)loop.InnerObject;<br />
src_query = sqlTask.SqlStatementSource;<br />
sql_task_name = container.Name;</p>
<p>string source = src_query;<br />
string[] stringSeparators = new string[] { &#8220;GO&#8221; };<br />
string[] result;</p>
<p>result = source.Split(stringSeparators, StringSplitOptions.None);</p>
<p>foreach (string s in result)<br />
{<br />
commandt = new SqlCommand(&#8220;INSERT INTO SQL_Task VALUES(@SRC_Q,@SQL_NAME)&#8221;, connectiont);<br />
commandt.Parameters.Add(new SqlParameter(&#8220;@SRC_Q&#8221;, s));<br />
commandt.Parameters.Add(new SqlParameter(&#8220;@SQL_NAME&#8221;, sql_task_name));<br />
commandt.ExecuteNonQuery();<br />
}<br />
}<br />
}</p>
<p></a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"></a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;"></a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Dts.TaskResult = (int)ScriptResults.Success;</a></p>
<p>We then save the package in a file system.</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">SIFISO_app.SaveToXml(&#8220;C:\\TEMP\\pkg_Execute_Sql_Tasks.dtsx&#8221;, dyna_pkg, null);</a></p>
<p><span style="text-decoration: underline;"><strong>Conclusion</strong></span></p>
<p>It&#8217;s that simple!</p>
<p>You can now execute your script task and the package will be created in location you specified.
<div class="pvc_clear"></div>
<p id="pvc_stats_242" class="pvc_stats " element-id="242"><img src="http://blogs.selectsifiso.com/wp-content/plugins/page-views-count/ajax-loader.gif" border=0 /></p>
<div class="pvc_clear"></div>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
		<span>Category: <a href="http://blogs.selectsifiso.com/category/execute-sql-task/" rel="category tag">Execute SQL Task</a> <a href="http://blogs.selectsifiso.com/category/forach-loop-container/" rel="category tag">ForEach Loop Container</a> <a href="http://blogs.selectsifiso.com/category/package-content-extraction/" rel="category tag">Reading SSIS Packages</a></span> <span>Tags: <a href="http://blogs.selectsifiso.com/tag/adventureworks2008r2/" rel="tag">AdventureWorks2008R2</a>, <a href="http://blogs.selectsifiso.com/tag/c/" rel="tag">C#</a>, <a href="http://blogs.selectsifiso.com/tag/c-programming-language/" rel="tag">C# programming language</a>, <a href="http://blogs.selectsifiso.com/tag/create-sql-view/" rel="tag">create SQL view</a>, <a href="http://blogs.selectsifiso.com/tag/create-ssis-package/" rel="tag">Create SSIS Package</a>, <a href="http://blogs.selectsifiso.com/tag/dynamic-ssis-package/" rel="tag">Dynamic SSIS Package</a>, <a href="http://blogs.selectsifiso.com/tag/execute-sql-task/" rel="tag">Execute SQL Task</a>, <a href="http://blogs.selectsifiso.com/tag/extract-sql-statement-source/" rel="tag">Extract SQL Statement source</a>, <a href="http://blogs.selectsifiso.com/tag/foreach-loop/" rel="tag">ForEach Loop</a>, <a href="http://blogs.selectsifiso.com/tag/foreachloop-container/" rel="tag">ForEachLoop Container</a>, <a href="http://blogs.selectsifiso.com/tag/read-sql-query/" rel="tag">Read SQL Query</a>, <a href="http://blogs.selectsifiso.com/tag/script-task/" rel="tag">script task</a>, <a href="http://blogs.selectsifiso.com/tag/sql-server-2008/" rel="tag">SQL Server 2008</a>, <a href="http://blogs.selectsifiso.com/tag/sql-server-integration-services/" rel="tag">SQL Server Integration Services</a>, <a href="http://blogs.selectsifiso.com/tag/sql-view/" rel="tag">SQL view</a>, <a href="http://blogs.selectsifiso.com/tag/ssis/" rel="tag">SSIS</a>, <a href="http://blogs.selectsifiso.com/tag/update-view/" rel="tag">update view</a></span> 
           						</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-239" class="post-239 post type-post status-publish format-standard hentry category-execute-sql-task category-for-loop-container category-package-content-extraction tag-adventureworks2008r2 tag-c-programming-language tag-create-sql-view tag-dynamic-ssis-package tag-execute-sql-task tag-extract-sql-statement-source tag-for-loop tag-for-loop-container tag-read-sql-query tag-script-task tag-sql-server-2008 tag-sql-server-integration-services tag-sql-view tag-ssis tag-update-view">
				<header class="entry-header">
						<h2 class="entry-title">
				<a href="http://blogs.selectsifiso.com/extract-save-sql-statements-of-execute-sql-tasks-in-a-for-loop-container-using-c/" title="Permalink to Extract &#038; Save SQL Statements of Execute SQL Tasks in a For Loop Container using C#" rel="bookmark">Extract &#038; Save SQL Statements of Execute SQL Tasks in a For Loop Container using C#</a>
			</h2>
											
			</header><!-- .entry-header -->

				<div class="entry-content">
			<p><span style="text-decoration: underline;"><strong>Abstract</strong></span></p>
<p><em>This article explains how to extract and save SQL Statements found in Execute SQL Tasks of an SSIS package that contains For Loop container using C# programming language.<br />
</em></p>
<p><span style="text-decoration: underline;"><strong>Requirements</strong></span></p>
<ul>
<li><em><a style="text-decoration: none; color: green;" href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=17319eb4-299c-43b8-a360-a1c2bd6a421b">Microsoft Visual Studio 2008</a></em><em> </em></li>
<li><em><a style="text-decoration: none; color: green;" href="http://www.microsoft.com/sqlserver/2008/en/us/overview.aspx">SQL Server 2008</a></em></li>
</ul>
<p><span style="text-decoration: underline;"><strong>Article</strong></span></p>
<p>This article continues from another article which can be found <a style="text-decoration: none; color: green;" href="http://www.blogs.selectsifiso.com/?p=204">here</a>.</p>
<p>Launch Visual Studio 2008 and create an Integration Services Project. After the default (new) package has launched, drag a script task to the control flow pane.</p>
<p>Right click to edit the script task. In your Script Task Editor ensure that you have selected Microsoft Visual C# as your programming language.</p>
<p>At the bottom of your Script Task Editor, click &#8220;Edit Script&#8221;.</p>
<p>Add the following references:</p>
<p><a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.aspx">System</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.aspx">System.Data</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sqlclient.aspx">System.Data.Sql</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sqltypes.aspx">System.Data.SqlTypes</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.data.sqlclient.aspx">System.Data.SqlClient</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.server.aspx">Microsoft.SqlServer.Server</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.tasks.scripttask.aspx">Microsoft.SqlServer.Dts.Tasks</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://technet.microsoft.com/en-us/library/microsoft.sqlserver.dts.tasks.executesqltask.executesqltask.aspx">Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.aspx">Microsoft.SqlServer.Dts.Runtime</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.wrapper.aspx">Microsoft.SqlServer.Dts.Pipeline.Wrapper</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.wrapper.aspx">RuntimeWrapper = Microsoft.SqlServer.Dts.Runtime.Wrapper</a>;<br />
<a style="text-decoration: none; color: blue;">using</a> <a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/system.io.aspx">System.IO</a>;</p>
<p>Proceed to load the package (that contains the Execute SQL Tasks you would like to extract and save).<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Application app = new Application();<br />
</a><br />
<a style="text-decoration: none; color: green;" href="http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.dts.runtime.application.loadfromsqlserver.aspx">Load package</a><br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">Package p = app.LoadPackage(&#8220;C:\\TEMP\\pkg_Execute_Sql_Tasks.dtsx&#8221;, null);</a></p>
<p>Establish a connection to SQL database where you will store the extracted SQL statements:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">SqlConnection connectiont = new SqlConnection(<br />
string.Format(&#8220;Data Source={0};Initial Catalog={1};Integrated Security=SSPI;&#8221;, &#8220;(local)&#8221;, &#8220;your_db&#8221;));<br />
SqlCommand commandt;<br />
connectiont.Open();</a></p>
<p>Declare variables that will be used to store extracted queries:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">string src_query2 = &#8220;&#8221;;<br />
string src_query3 = &#8220;&#8221;;<br />
string src_query = &#8220;&#8221;;<br />
string sql_task_name = &#8220;&#8221;;</a></p>
<p>The rest of the code is as follows:<br />
<a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">foreach (Executable executable in importPackage.Executables)<br />
{<br />
//This part is for Execute SQL Tasks found within the For Loop Container<br />
DtsContainer container = (DtsContainer)executable;<br />
//NB: The executable type is case sensitive. Hence, make sure you give the type of the executable below as &#8220;ForLoop&#8221; instead of &#8220;FORLOOP&#8221;<br />
if (executable.GetType().Name == &#8220;ForLoop&#8221;)<br />
{<br />
ForLoop seq = (ForLoop)executable;<br />
foreach (Executable ForLp_exec in seq.Executables)<br />
{<br />
DtsContainer ForLp_container = (DtsContainer)ForLp_exec;<br />
if (ForLp_exec.GetType().Name == &#8220;TaskHost&#8221;)<br />
{<br />
TaskHost loop = (TaskHost)ForLp_exec;<br />
ExecuteSQLTask sqlTask = (ExecuteSQLTask)loop.InnerObject;<br />
src_query2 = sqlTask.SqlStatementSource;<br />
src_query3 = src_query2.ToUpper();<br />
src_query = src_query3;<br />
sql_task_name = ForLp_container.Name;</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">//Split extracted queries on keyword Go<br />
string source3 = src_query;<br />
string[] stringSeparators3 = new string[] { &#8220;GO&#8221; };<br />
string[] result3;</a></p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">result3 = source3.Split(stringSeparators3, StringSplitOptions.None);</p>
<p>foreach (string s in result3)<br />
{<br />
//NB: You can replace table name &#8220;SQL_Task&#8221; with your own table<br />
commandt = new SqlCommand(&#8220;INSERT INTO SQL_Task VALUES(@SRC_Q,@SQL_NAME)&#8221;, connectiont);<br />
commandt.Parameters.Add(new SqlParameter(&#8220;@SRC_Q&#8221;, s));<br />
commandt.Parameters.Add(new SqlParameter(&#8220;@SQL_NAME&#8221;, sql_task_name));<br />
commandt.ExecuteNonQuery();<br />
}<br />
}<br />
}<br />
}<br />
//This part is for Execute SQL Tasks found outside of the For Loop Container<br />
if (executable.GetType().Name == &#8220;TaskHost&#8221;)<br />
{<br />
TaskHost loop = (TaskHost)executable;<br />
ExecuteSQLTask sqlTask = (ExecuteSQLTask)loop.InnerObject;<br />
src_query = sqlTask.SqlStatementSource;<br />
sql_task_name = container.Name;</p>
<p>string source = src_query;<br />
string[] stringSeparators = new string[] { &#8220;GO&#8221; };<br />
string[] result;</p>
<p>result = source.Split(stringSeparators, StringSplitOptions.None);</p>
<p>foreach (string s in result)<br />
{<br />
commandt = new SqlCommand(&#8220;INSERT INTO SQL_Task VALUES(@SRC_Q,@SQL_NAME)&#8221;, connectiont);<br />
commandt.Parameters.Add(new SqlParameter(&#8220;@SRC_Q&#8221;, s));<br />
commandt.Parameters.Add(new SqlParameter(&#8220;@SQL_NAME&#8221;, sql_task_name));<br />
commandt.ExecuteNonQuery();<br />
}<br />
}<br />
}</p>
<p>Dts.TaskResult = (int)ScriptResults.Success;</a></p>
<p>We then save the package in a file system.</p>
<p><a style="text-decoration: none; font-size: 10pt; color: #9900ff; font-family: Calibri;">SIFISO_app.SaveToXml(&#8220;C:\\TEMP\\pkg_Execute_Sql_Tasks.dtsx&#8221;, dyna_pkg, null);</a></p>
<p><span style="text-decoration: underline;"><strong>Conclusion</strong></span></p>
<p>It&#8217;s that simple!</p>
<p>You can now execute your script task and the package will be created in location you specified.
<div class="pvc_clear"></div>
<p id="pvc_stats_239" class="pvc_stats " element-id="239"><img src="http://blogs.selectsifiso.com/wp-content/plugins/page-views-count/ajax-loader.gif" border=0 /></p>
<div class="pvc_clear"></div>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
		<span>Category: <a href="http://blogs.selectsifiso.com/category/execute-sql-task/" rel="category tag">Execute SQL Task</a> <a href="http://blogs.selectsifiso.com/category/for-loop-container/" rel="category tag">For Loop Container</a> <a href="http://blogs.selectsifiso.com/category/package-content-extraction/" rel="category tag">Reading SSIS Packages</a></span> <span>Tags: <a href="http://blogs.selectsifiso.com/tag/adventureworks2008r2/" rel="tag">AdventureWorks2008R2</a>, <a href="http://blogs.selectsifiso.com/tag/c-programming-language/" rel="tag">C# programming language</a>, <a href="http://blogs.selectsifiso.com/tag/create-sql-view/" rel="tag">create SQL view</a>, <a href="http://blogs.selectsifiso.com/tag/dynamic-ssis-package/" rel="tag">Dynamic SSIS Package</a>, <a href="http://blogs.selectsifiso.com/tag/execute-sql-task/" rel="tag">Execute SQL Task</a>, <a href="http://blogs.selectsifiso.com/tag/extract-sql-statement-source/" rel="tag">Extract SQL Statement source</a>, <a href="http://blogs.selectsifiso.com/tag/for-loop/" rel="tag">For Loop</a>, <a href="http://blogs.selectsifiso.com/tag/for-loop-container/" rel="tag">For Loop Container</a>, <a href="http://blogs.selectsifiso.com/tag/read-sql-query/" rel="tag">Read SQL Query</a>, <a href="http://blogs.selectsifiso.com/tag/script-task/" rel="tag">script task</a>, <a href="http://blogs.selectsifiso.com/tag/sql-server-2008/" rel="tag">SQL Server 2008</a>, <a href="http://blogs.selectsifiso.com/tag/sql-server-integration-services/" rel="tag">SQL Server Integration Services</a>, <a href="http://blogs.selectsifiso.com/tag/sql-view/" rel="tag">SQL view</a>, <a href="http://blogs.selectsifiso.com/tag/ssis/" rel="tag">SSIS</a>, <a href="http://blogs.selectsifiso.com/tag/update-view/" rel="tag">update view</a></span> 
           						</footer><!-- .entry-meta -->
	</article><!-- #post -->
			
					<nav id="nav-below" class="navigation" role="navigation">
			<div class="assistive-text">Post navigation</div>
			<div class="nav-previous alignleft"><a href="http://blogs.selectsifiso.com/author/sifiso-ndlovu/page/7/" ><span class="meta-nav">&larr;</span> Older posts</a></div>
			<div class="nav-next alignright"><a href="http://blogs.selectsifiso.com/author/sifiso-ndlovu/page/5/" >Newer posts <span class="meta-nav">&rarr;</span></a></div>
		</nav><!-- #nav-below .navigation -->
	
		
		</div><!-- #content -->
	</section><!-- #primary -->


		
	 		<div id="secondary" class="widget-area" role="complementary">
			<div class="widget widget_search">
				<form role="search" method="get" id="searchform" class="searchform" action="http://blogs.selectsifiso.com/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form>			</div>
			<div class="widget widget_recent_entries">
				<p class="widget-title">Recent Posts</p>
				<ul>	<li><a href='http://blogs.selectsifiso.com/duplicate-mysql-table-using-phpmyadmin/'>Duplicate MySQL Table Using phpMyAdmin</a></li>
	<li><a href='http://blogs.selectsifiso.com/wheres-my-team-explorer-2015/'>Where&#8217;s my Team Explorer 2015?</a></li>
	<li><a href='http://blogs.selectsifiso.com/sql-server-database-source-control-using-vso-git/'>SQL Server Database Source Control using VSO Git</a></li>
	<li><a href='http://blogs.selectsifiso.com/dimensional-modelling-in-lucidchart-vs-visio-part-1/'>Dimensional Modelling in Lucidchart vs Visio: Part 1</a></li>
	<li><a href='http://blogs.selectsifiso.com/execute-all-packages-within-ssis-project-catalog/'>Execute All Packages Within SSIS Project Catalog</a></li>
</ul>
			</div>
			<div class="widget widget_pages">
			<p class="widget-title">Pages</p>
          <ul><li class="page_item page-item-776"><a href="http://blogs.selectsifiso.com/about/">About</a></li>
<li class="page_item page-item-791"><a href="http://blogs.selectsifiso.com/articles/">Articles</a></li>
<li class="page_item page-item-947"><a href="http://blogs.selectsifiso.com/codeplex/">CodePlex</a></li>
<li class="page_item page-item-19"><a href="http://blogs.selectsifiso.com/contact/">Contact</a></li>
<li class="page_item page-item-740"><a href="http://blogs.selectsifiso.com/contributors/">Contributors</a></li>
<li class="page_item page-item-882"><a href="http://blogs.selectsifiso.com/disclaimer/">Disclaimer</a></li>
<li class="page_item page-item-868"><a href="http://blogs.selectsifiso.com/events/">Events</a></li>
<li class="page_item page-item-938"><a href="http://blogs.selectsifiso.com/github/">GitHub</a></li>
<li class="page_item page-item-806"><a href="http://blogs.selectsifiso.com/manage-subscriptions/">Manage Subscriptions</a></li>
<li class="page_item page-item-808"><a href="http://blogs.selectsifiso.com/nl-confirm-signup/">Newsletter Sign Up Confirmation</a></li>
<li class="page_item page-item-809"><a href="http://blogs.selectsifiso.com/nl-unsubscribe-page/">Newsletter Unsubscription</a></li>
<li class="page_item page-item-781"><a href="http://blogs.selectsifiso.com/newsletters/">Newsletters</a></li>
<li class="page_item page-item-891"><a href="http://blogs.selectsifiso.com/privacy-policy/">Privacy Policy</a></li>
<li class="page_item page-item-635"><a href="http://blogs.selectsifiso.com/rss-feeds/">RSS Feeds</a></li>
<li class="page_item page-item-778"><a href="http://blogs.selectsifiso.com/source-code/">Source Code</a></li>
<li class="page_item page-item-903"><a href="http://blogs.selectsifiso.com/terms/">Terms and Conditions</a></li>
<li class="page_item page-item-780"><a href="http://blogs.selectsifiso.com/tutorials/">Videos</a></li>
</ul>
      </div>
	  
	  <div class="widget widget_tag_cloud">
       <p class="widget-title">Tag Cloud</p>
        <a href='http://blogs.selectsifiso.com/tag/adventureworks2008r2/' class='tag-link-21' title='20 topics' style='font-size: 17.826086956522px;'>AdventureWorks2008R2</a>
<a href='http://blogs.selectsifiso.com/tag/c/' class='tag-link-12' title='30 topics' style='font-size: 19.673913043478px;'>C#</a>
<a href='http://blogs.selectsifiso.com/tag/c-programming-language/' class='tag-link-15' title='32 topics' style='font-size: 20px;'>C# programming language</a>
<a href='http://blogs.selectsifiso.com/tag/create-sql-view/' class='tag-link-17' title='13 topics' style='font-size: 15.978260869565px;'>create SQL view</a>
<a href='http://blogs.selectsifiso.com/tag/create-ssis-package/' class='tag-link-18' title='24 topics' style='font-size: 18.695652173913px;'>Create SSIS Package</a>
<a href='http://blogs.selectsifiso.com/tag/data-flow-task/' class='tag-link-193' title='10 topics' style='font-size: 14.782608695652px;'>Data Flow Task</a>
<a href='http://blogs.selectsifiso.com/tag/destination-component/' class='tag-link-48' title='12 topics' style='font-size: 15.54347826087px;'>Destination Component</a>
<a href='http://blogs.selectsifiso.com/tag/dts/' class='tag-link-43' title='9 topics' style='font-size: 14.347826086957px;'>DTS</a>
<a href='http://blogs.selectsifiso.com/tag/dynamic-ssis-package/' class='tag-link-9' title='28 topics' style='font-size: 19.347826086957px;'>Dynamic SSIS Package</a>
<a href='http://blogs.selectsifiso.com/tag/execute-sql-task/' class='tag-link-190' title='13 topics' style='font-size: 15.978260869565px;'>Execute SQL Task</a>
<a href='http://blogs.selectsifiso.com/tag/extract-sql-statement-source/' class='tag-link-22' title='7 topics' style='font-size: 13.260869565217px;'>Extract SQL Statement source</a>
<a href='http://blogs.selectsifiso.com/tag/file/' class='tag-link-39' title='4 topics' style='font-size: 11.086956521739px;'>file</a>
<a href='http://blogs.selectsifiso.com/tag/foreach-loop/' class='tag-link-27' title='4 topics' style='font-size: 11.086956521739px;'>ForEach Loop</a>
<a href='http://blogs.selectsifiso.com/tag/foreachloop-container/' class='tag-link-28' title='4 topics' style='font-size: 11.086956521739px;'>ForEachLoop Container</a>
<a href='http://blogs.selectsifiso.com/tag/ole-db/' class='tag-link-44' title='15 topics' style='font-size: 16.521739130435px;'>OLE DB</a>
<a href='http://blogs.selectsifiso.com/tag/oledb-destination/' class='tag-link-46' title='12 topics' style='font-size: 15.54347826087px;'>OLEDB Destination</a>
<a href='http://blogs.selectsifiso.com/tag/oledb-source/' class='tag-link-45' title='11 topics' style='font-size: 15.217391304348px;'>OLEDB Source</a>
<a href='http://blogs.selectsifiso.com/tag/read-sql-query/' class='tag-link-23' title='8 topics' style='font-size: 13.804347826087px;'>Read SQL Query</a>
<a href='http://blogs.selectsifiso.com/tag/script-task/' class='tag-link-13' title='26 topics' style='font-size: 19.021739130435px;'>script task</a>
<a href='http://blogs.selectsifiso.com/tag/sequence-container/' class='tag-link-191' title='3 topics' style='font-size: 10px;'>Sequence Container</a>
<a href='http://blogs.selectsifiso.com/tag/source-component/' class='tag-link-47' title='10 topics' style='font-size: 14.782608695652px;'>Source Component</a>
<a href='http://blogs.selectsifiso.com/tag/sql-server-2008/' class='tag-link-11' title='24 topics' style='font-size: 18.695652173913px;'>SQL Server 2008</a>
<a href='http://blogs.selectsifiso.com/tag/sql-server-integration-services/' class='tag-link-19' title='31 topics' style='font-size: 19.891304347826px;'>SQL Server Integration Services</a>
<a href='http://blogs.selectsifiso.com/tag/sql-view/' class='tag-link-14' title='13 topics' style='font-size: 15.978260869565px;'>SQL view</a>
<a href='http://blogs.selectsifiso.com/tag/ssis/' class='tag-link-5' title='25 topics' style='font-size: 18.804347826087px;'>SSIS</a>
<a href='http://blogs.selectsifiso.com/tag/ssis-2012/' class='tag-link-205' title='5 topics' style='font-size: 11.95652173913px;'>SSIS 2012</a>
<a href='http://blogs.selectsifiso.com/tag/transformation/' class='tag-link-54' title='4 topics' style='font-size: 11.086956521739px;'>Transformation</a>
<a href='http://blogs.selectsifiso.com/tag/update-view/' class='tag-link-16' title='11 topics' style='font-size: 15.217391304348px;'>update view</a>
<a href='http://blogs.selectsifiso.com/tag/visual-studio-2010/' class='tag-link-95' title='4 topics' style='font-size: 11.086956521739px;'>Visual Studio 2010</a>
<a href='http://blogs.selectsifiso.com/tag/xml/' class='tag-link-201' title='4 topics' style='font-size: 11.086956521739px;'>XML</a>			</div>
		</div><!-- #secondary -->
		</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
		<div class="footercopy">custom footer text left</div>
		<div class="footercredit">custom footer text right</div>
		<div class="clear"></div>
		</div><!-- .site-info -->
		</footer><!-- #colophon -->
		<div class="site-wordpress">
				<a href="http://themonic.com/iconic-one/">Iconic One</a> Theme | Powered by <a href="http://wordpress.org">Wordpress</a>
				</div><!-- .site-info -->
				<div class="clear"></div>
</div><!-- #page -->




<script type='text/javascript' src='http://blogs.selectsifiso.com/wp-content/plugins/contact-form-7/includes/js/jquery.form.min.js?ver=06820f499ad3078ba51bb8a3026295a9-2014.06.20'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var _wpcf7 = {"loaderUrl":"http:\/\/blogs.selectsifiso.com\/wp-content\/plugins\/contact-form-7\/images\/ajax-loader.gif","recaptchaEmpty":"Please verify that you are not a robot.","sending":"Sending ..."};
/* ]]> */
</script>
<script type='text/javascript' src='http://blogs.selectsifiso.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=06820f499ad3078ba51bb8a3026295a9'></script>
<script type='text/javascript' src='http://blogs.selectsifiso.com/wp-content/themes/iconic-one/js/selectnav.js?ver=06820f499ad3078ba51bb8a3026295a9'></script>
<script type='text/javascript' src='http://blogs.selectsifiso.com/wp-includes/js/wp-embed.min.js?ver=06820f499ad3078ba51bb8a3026295a9'></script>
<script type='text/javascript' src='http://blogs.selectsifiso.com/wp-content/plugins/simplified-social-share/oss-social-sharing/assets/js/oss_share.js?ver=06820f499ad3078ba51bb8a3026295a9'></script>
<script type='text/javascript' src='https://sharecdn.social9.com/v2/js/opensocialsharedefaulttheme.js?ver=06820f499ad3078ba51bb8a3026295a9'></script>
<script type='text/javascript' src='https://sharecdn.social9.com/v2/js/opensocialshare.js?ver=06820f499ad3078ba51bb8a3026295a9'></script>

               <script type="text/javascript">
        var shareWidget = new OpenSocialShare();
        shareWidget.init({
             isEmailContentReadOnly:false,isTotalShare:true,isMobileFriendly:true,isShortenUrl:true,isOpenSingleWindow:false,                 
            isCounterWidgetTheme: 0, // 0 or 1 - standard themes or counter widget themes
            isHorizontalCounter: 0, // 0 or 1 - counter on top or counter to right - counter themes only
            isHorizontalLayout: 1, // 0 or 1 - vertical layout or horizontal layout
            widgetIconSize: "32", // "16" or "32" - 16px or 32px standard themes only
                       widgetStyle: "responsive", //"image", "square" or "responsive" - standard themes only
            
           
            providers: {
                
                   top: ["Facebook","Twitter","LinkedIn","GooglePlus","Pinterest","Email","Print"]
                },
           widgets: {
                 //all : _private.getAllButtonName(_private.widgetConfig),
                      top: ["Facebook Like","Twitter Tweet","Google+ Share","Pinterest Pin it","LinkedIn Share"]
                      },
                          theme: 'OpenSocialShareDefaultTheme',
             
        });
        shareWidget.injectInterface(".oss_horizontal_share");
        shareWidget.setWidgetTheme(".oss_horizontal_share");
    </script>
            </body>
</html>